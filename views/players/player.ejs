
<html>

    <head>
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">

        <style>html{visibility: hidden;opacity:0;}</style>

    </head>

    <script>

    </script>

    <body onload="getItemInfo(),httpscheck()">
            <div class="topbar">
                    <img src="https://i.imgur.com/UUFNpMd.png" class="TEM" style="width:13rem;" draggable="false">
                    <form action="/" method="POST">
                            <input type="text" name="search" id="search" class="search" placeholder="Items And Players" value="<%=search%>" required>
                            <span class="material-icons">search</span>
                        <button type="submit"  class="submit">Search</button>
                    </form>
                
            </div>
        
            <div class="main">
                <div class="Item">
                    <h1 class="ititle" id="ititle">Items</h1>
                        <div class="itemdiscription" id="itemdiscription">
                            <div class="binfoFrame">
                                    
                            </div>

                            <div class="itemFrame">


                            </div>

                        </div>
                </div>

                <div class="vline"></div>

            </div>

                
    </body>
</html>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<script>
    let stars = {"0":"","1":"✪","2":"✪✪","3":"✪✪✪","4":"✪✪✪✪","5":"✪✪✪✪✪","6":"✪✪✪✪✪➀","7":"✪✪✪✪✪➁","8":"✪✪✪✪✪➂","9":"✪✪✪✪✪➃","10":"✪✪✪✪✪➄"};
    let itemrarity = {"common":"0","uncommon":"1","rare":"2","epic":"3","legendary":"4","mythic":"5","divine":"6","special":"7","very_special":"8"};
    let raritycolor = {"0":"#FFFFFF","1":"#55FF55","2":"#5555FF","3":"#AA00AA","4":"#FFAA00","5":"#FF55FF","6":"#55FFFF","7":"#FF5555","8":"#FF5555"};
    let maxenchantlvl = {"Bane of Arthropods":"7","Cleave":"6","Critical":"7"}
    let itemData = null;
    let itemProcessing = false;
    //console.log("hey cutie pie <3")
    async function httpscheck() {
        // check for localhost
        if(window.location.href.includes("localhost")){
            return;
        }
        
        else if (window.location.protocol != "https:")
            window.location.href = "https:" + window.location.href.substring(window.location.protocol.length);
    }

    let playerOptions = {
            method: 'GET',
            url: 'https://api.tem.cx/items/player/' + '<%=search%>',
            headers: {'Content-Type': 'application/json'}
    }

    async function getPlayer() {
        let attempts = 0;
        while (itemProcessing) {
            if (attempts > 5) {
                return {}
            }
            await new Promise(r => setTimeout(r, 1000));
            attempts++
        }
        if (itemData == null) {
            itemProcessing = true;
            await axios.request(playerOptions).then(function (response) {
                itemData = response.data
            })
            itemProcessing = false;
        }
        return itemData
    }

    async function getPlayerName(id) {
        let playerName = ''
        await axios.get('https://mc-heads.net/minecraft/profile/' + id).then(function (response) {
            playerName = response.data
        })
        return playerName
    }

    async function getItemInfo(){
        const player = await getPlayer()
        const g = 0
        //console.log("hey sweetie pie")
        for(let i in player["items"]){
            //console.log(i)
            //console.log(g)
            const uuidd = i["_id"]
            let uuid = document.createElement(uuidd)
            document.getElementById("itemdiscription").appendChild(uuid)


            let itemOptions = {
                method: 'GET',
                url: 'https://api.tem.cx/items/' + uuid,
                headers: {'Content-Type': 'application/json'}
            }

            async function getItem() {
                let attempts = 0;
                while (itemProcessing) {
                    if (attempts > 5) {
                        return {}
                    }
                await new Promise(r => setTimeout(r, 1000));
                attempts++
            }
            if (itemData == null) {
                itemProcessing = true;
                await axios.request(itemOptions).then(function (response) {
                    itemData = response.data
                })
                itemProcessing = false;
            }
            return itemData
            }



            const item = await getItem()
            const itemInfo = item.item
            const itemName = itemInfo.itemId
            const enchantments = itemInfo.enchantments

            //item img

            async function getItemRarity(rarity){
                const lowerrarity = rarity.toLowerCase();
                let rarityvalue = itemrarity[lowerrarity]
                if(itemInfo.extraAttributes.rarity_upgrades == '1'){
                    rarityvalue = parseInt(rarityvalue) + 1
                }
                return rarityvalue
            }

            let itemImg = document.createElement('img')
            itemImg.src = 'https://sky.shiiyu.moe/item/' + itemName
            itemImg.className = 'itemImg'
            uuid.getElementsByClassName('itemFrame')[g].appendChild(itemImg)

            //item Name

            let itemRarityNumber = await getItemRarity(itemInfo.rarity)
            let itemDName = document.createElement('p')
            itemDName.innerHTML = itemInfo.friendlyName
            itemDName.className = 'itemDName'
            itemDName.style.color = raritycolor[itemRarityNumber]
            uuid.getElementsByClassName('binfoFrame')[g].appendChild(itemDName)


            //Stars

            if(itemInfo.extraAttributes.dungeon_item_level != undefined){
                let itemStars = document.createElement('p')
                itemStars.innerHTML = stars[itemInfo.extraAttributes.dungeon_item_level]
                itemStars.className = 'itemStars'
                uuid.getElementsByClassName('binfoFrame')[g].appendChild(itemStars)
            }
        g++
    }

    }

</script>



<style scoped>
@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@1,600&family=Montserrat&display=swap');



* {
  margin: 0;
  padding: 0;
  white-space: normal;
  transition: all 0.2s ease-in-out;
  overflow: hidden;
}
body{
    background-color: #232931;
    font-family: 'Montserrat', sans-serif;
}
/* Topbar */
.topbar{
    background-color: #232931;
    height: 5rem;
    width: 100%;
    position: fixed;
    box-shadow: rgba(0, 0, 0, 0.09) 0px 2px 1px, rgba(0, 0, 0, 0.09) 0px 4px 2px, rgba(0, 0, 0, 0.09) 0px 8px 4px, rgba(0, 0, 0, 0.09) 0px 16px 8px, rgba(0, 0, 0, 0.09) 0px 32px 16px;    
}

.Item{
    position: absolute;
    width: 60%;
    height: 100%;

}
.tem{
    position: fixed;
    padding-left: 2rem;
    top: -4rem;
    -webkit-user-select: none;  /* Chrome all / Safari all */
    -moz-user-select: none;     /* Firefox all */
    -ms-user-select: none;      /* IE 10+ */
    user-select: none; 
}
input{
    position: relative;
    width: 30rem;
    height: 2.5rem;
    border-radius: 10px;
    font-family: 'Montserrat', sans-serif;
    font-size: 1rem;
    color: #EEEEEE;
    background-color: #393E46;
    outline: none;
    padding-left: 5vh;
    border: none;
    box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
}

input:hover , input:focus{
    transition: all 0.2s ease-in-out;
    box-shadow: rgba(50, 50, 93, 0.25) 0px 13px 27px -5px, rgba(0, 0, 0, 0.3) 0px 8px 16px -8px;

}

.topbar input::placeholder{
    color: #EEEEEE;
}

.search{
    position: absolute;
    right: 11rem;
    top: 1.3rem;
    padding: 1rem;
}

.topbar span{
    float: right;
    margin-right: 12rem;
    margin-top: 1.6rem;
    position: relative;
    z-index: 2;
    color: #EEEEEE;
    font-size: 2rem;
}

button {
    top: 1.3rem;
    right: 1.5rem;
    position: absolute;
    background-color: #393E46;
    border-radius: 5px;
    border-style: none;
    box-sizing: border-box;
    color: #EEEEEE;
    cursor: pointer;
    display: inline-block;
    font-family: 'Montserrat', sans-serif;
    font-size: 1em;
    font-weight: 500;
    height: 2.5rem;
    line-height: 20px;
    list-style: none;
    margin: 0;
    outline: none;
    padding: 1vh 1.5vw;
    text-align: center;
    text-decoration: none;
    transition: color 100ms;
    vertical-align: baseline;
    user-select: none;
    -webkit-user-select: none;
    touch-action: manipulation;
    box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
}
button:hover{
    transition: all 0.2s ease-in-out;
    background-color: #4ECCA3;
    color: #232931;
    box-shadow: rgba(50, 50, 93, 0.25) 0px 13px 27px -5px, rgba(0, 0, 0, 0.3) 0px 8px 16px -8px;
}

/* Main */

.main{
    position: absolute;
    top: 5rem;
    width: 100%;
    height: 100%;
    overflow: hidden;
    
}




/* history */

.history{
    position: absolute;
    width: 40%;
    height: 100%;
    right: 0;
    overflow-y: auto;
    overflow-x: disabled;
}

.history div:not(.vline,.bmargin){
    position: relative;
    display: inline-block;
    top: 0rem;
    padding-left: 1.5vw;
    width: 35vw;
    margin-right: -1rem;
    padding-top: 1.5rem;
    padding-bottom: 1.5rem;

    margin-left: 2rem;
    margin-top: 5rem;
    border-radius: 10px;
    background-color: #393E46;
    box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
    overflow-x: auto;
}

.history div:not(.vline,.bmargin):hover{
    transition: all 0.2s ease-in-out;
    box-shadow: rgba(50, 50, 93, 0.25) 0px 13px 27px -5px, rgba(0, 0, 0, 0.3) 0px 8px 16px -8px;
}

.history div img{
    width: 8rem;
    border-radius: .5rem;

}

.history div .formattedParagraph {
    width: auto;
    position: absolute;
    top: 2rem;
    left: 11rem;
    font-size: 2rem;
    font-weight: 750;
    color: #4ECCA3;
}

.history div p {
    width: auto;
    top: 2rem;
}

.startDate {
    position: absolute;
    padding-top: 7.5vh;
    left: 32rem;
    font-size: 1.5rem;
    font-weight: 750;
    color: #4ECCA3;
}
.endDate {
    position: absolute;
    padding-top: 0rem;
    left: 32rem;
    font-size: 1.5rem;
    font-weight: 750;
    color: #4ECCA3;
}

.startDate span{
    position: relative;
    color: #EEEEEE;
    font-size: 2rem;
    top: 0.3rem;
    left: 0.2rem;
}

.endDate span{
    position: relative;
    color: #EEEEEE;
    font-size: 2rem;
    top: 0.3rem;
    left: 0.2rem;
}


.vline{
    overflow-y: hidden;
    position: absolute;
    display: inline;
    width: 0.1rem;
    height: inherit;
    background-color: #393E46;
    right: 40%;
    overflow-y: hidden;
}

.historytitle{
    position: absolute;
    left: 17rem;
    top: 1rem;
    font-size: 2rem;
    font-weight: 1000;
    color: #EEEEEE;
}





.bmargin{
    position: absolute;
    height: 10rem;
    width: 100%;
    align-self: bottom;
}

/* items */

.itemdiscription{
    position: absolute;
    top: 8.5vh;
    left: 1vw;
    width:42vw;
    height: 82%;
    border-radius: 15px;
    overflow-y: auto;
    overflow-x: auto;
    background-color: #393E46;
    box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
}

.itemdiscription:hover{
    transition: all 0.2s ease-in-out;
    box-shadow: rgba(50, 50, 93, 0.25) 0px 13px 27px -5px, rgba(0, 0, 0, 0.3) 0px 8px 16px -8px;
}

.enchantments{
    position: absolute;
    top: 8.5vh;
    right: 1vw;
    width:15vw;
    height: 82%;
    border-radius: 15px;
    overflow-y: auto;
    overflow-x: auto;
    background-color: #393E46;
    box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
}

.enchantments:hover{
    transition: all 0.2s ease-in-out;
    box-shadow: rgba(50, 50, 93, 0.25) 0px 13px 27px -5px, rgba(0, 0, 0, 0.3) 0px 8px 16px -8px;
}

.enchantment{
    position: relative;
    display: block;
    text-align: right;
    padding-right: 3rem;
    font-size: 1.5rem;
    font-weight: 500;
    color: #EEEEEE;
    margin-top: 0.5rem;
}
.enchantmentLevel{
    position: relative;
    display: block;
    bottom:0.2rem;
    left: 1.5rem;
    margin-top: -1.5rem;
    font-size: 1.5rem;
    font-weight: 500;
    color: #4ECCA3;
}

.etitle{
    position: absolute;
    left: 45vw;
    top: 1vh;
    font-size: 2rem;
    font-weight: 1000;
    color: #EEEEEE;
}
.ititle{
    position: absolute;
    left: 15vw;
    top: 1vh;
    font-size: 2rem;
    font-weight: 1000;
    color: #EEEEEE;
}

.itemDname{
    position: absolute;
    left: 1vw;
    top: 2vh;
    font-size: 2.5rem;
    font-weight: 1000;
}
.itemStars{
    position: absolute;
    left: 1.1vw;
    top: 6.5vh;
    font-size: 1.5rem;
    font-weight: 500;
    color: #EEEEEE;
}

.binfoFrame{
    padding: 1rem;
    position: relative;
    top: 2vh;
    left: 11.5vw;
    width: 66%;
    height: 8vw;
    background-color: #232931;
    align-content: center;
    border-radius: 10px;
    box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
    outline-width: 2px;
    outline-style: solid;
    outline-color: #4ECCA3;
}

.binfoFrame:hover{
    transition: all 0.2s ease-in-out;
    outline-color: #4ecca200;
    box-shadow: rgba(50, 50, 93, 0.25) 0px 13px 27px -5px, rgba(0, 0, 0, 0.3) 0px 8px 16px -8px;
}

.itemframe{
    padding: 1rem;
    position: absolute;
    top: 2vh;
    left: 2vh;
    width: 8vw;
    height: 8vw;
    background-color: #232931;
    align-content: center;
    border-radius: 10px;
    box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
    outline-width: 2px;
    outline-style: solid;
    outline-color: #4ECCA3;
}

.itemframe:hover{
    transition: all 0.2s ease-in-out;
    box-shadow: rgba(50, 50, 93, 0.25) 0px 13px 27px -5px, rgba(0, 0, 0, 0.3) 0px 8px 16px -8px;
    outline-color: #4ecca200;

}

.itemImg{
    width: inherit;
    height: inherit;
    margin: 0;
    position: absolute;
    top: 50%;
    left: 50%;
    -ms-transform: translate(-50%, -50%);
    transform: translate(-50%, -50%);
}

/* Footer */

/* ===== Scrollbar CSS ===== */
  /* Firefox */
  * {
    scrollbar-width: thin;
    scrollbar-color: #4ECCA3 #ffffff5c;
  }

  /* Chrome, Edge, and Safari */
  *::-webkit-scrollbar {
    width: 12px;
  }

  *::-webkit-scrollbar-track {
    background: #ffffff00;
  }

  *::-webkit-scrollbar-thumb {
    background-color: #4ECCA3;
    border-radius: 18px;
    border: 4px solid #ffffff00;
  }


html {
    visibility: visible;
    opacity: 1;
}

</style>